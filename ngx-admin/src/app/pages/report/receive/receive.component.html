<div class="row">
  <div class="col-12">
    <nb-card>
      <nb-card-header>
        <div class="pull-left">Laporan Penerimaan</div>
        <div class="pull-right">
          <button title="Cari" class="btn btn-header btn-icon" (click)="showSearch()">
            <i class="ion-search"></i>
          </button>
        </div>
      </nb-card-header>
      <nb-card-body [ngClass]="'flexbox flexbox-column'">
        <div *ngIf="result.length == 0">
          Tidak ada data.
        </div>
        <div *ngIf="result.length > 0" class="flexbox flexbox-column overflow-auto">
          <table class="table table-hovered table-bordered">
            <thead>
              <tr>
                <th class="no">No.</th>
                <th colspan="3" class="txt-center">Aksi</th>
                <th>Invoice</th>
                <th>Kontak</th>
                <th>Tgl</th>
                <th>Status</th>
                <th>Bruto</th>
                <th>Beban<br>Pajak</th>
                <th>Potongan<br>Harga</th>
                <th>Potongan<br>Kembalian</th>
                <th>Total<br>Nett.</th>
                <th>Cash</th>
                <th>Hutang</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of result; let i = index;">
                <td>{{ addTotal(i, item) }}</td>
                <td class="icon" (click)="retrieveInvoice(item.id)" title="Buka Invoice">
                  <i
                    [innerHTML]="'code' | eva: { animationType: 'pulse', animationInfinite: true, width:'16px', fill: '#4CAF50' }"></i>
                </td>
                <td class="icon" (click)="showContact(item.id)" title="Ubah Kontak">
                  <i
                    [innerHTML]="'person-add' | eva: { animationType: 'pulse', animationInfinite: true, width:'16px', fill: '#4CAF50' }"></i>
                </td>
                <td class="icon" (click)="toggleVoid(item.id)" title="Toggle Void">
                  <i
                    [innerHTML]="'flip-2' | eva: { animationType: 'pulse', animationInfinite: true, width:'16px', fill: '#4CAF50' }"></i>
                </td>
                <td>{{ item.invoice }}</td>
                <td>{{ item.contact }}</td>
                <td>{{ item.date }}</td>
                <td>{{ txtStatus(item.status) }}</td>
                <td>
                  <input-currency [model]="item.amount" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="item.taxIncluded" [class]="'amount'" [fractionSizeDisplay]="2"
                    [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="item.discount" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="item.shortCost" [class]="'amount'" [fractionSizeDisplay]="2"
                    [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="item.nettWorth" [class]="'amount'" [fractionSizeDisplay]="2"
                    [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="item.cash" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="item.arap" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
              </tr>
              <tr>
                <td colspan="8" class="txt-total">TOTAL</td>
                <td>
                  <input-currency [model]="total.bruto" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="total.tax" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="total.short" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="total.discount" [class]="'amount'" [fractionSizeDisplay]="2"
                    [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="total.nett" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="total.cash" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
                <td>
                  <input-currency [model]="total.arap" [class]="'amount'" [fractionSizeDisplay]="2" [disabled]="true"
                    [asInput]="false" [strictFraction]="true">
                  </input-currency>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
  <ng-template #contentTemplate let-data>
    <div style="min-width: 500px">
      <div class="form-group row">
        <label class="col-3">Tanggal</label>
        <div class="col-9">
          <input nbInput placeholder="Range Picker" [nbDatepicker]="rangepicker" [(ngModel)]="parameter.date"
            class="form-control">
          <nb-rangepicker #rangepicker format="dd/MM/yyyy"></nb-rangepicker>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-3">No. Invoice</label>
        <div class="col-9">
          <input class="form-control" [(ngModel)]="parameter.invNo">
        </div>
      </div>
      <div class="form-group row">
        <label class="col-3">Kontak/Tlp</label>
        <div class="col-9">
          <input class="form-control" [(ngModel)]="parameter.contact">
        </div>
      </div>
      <div class="form-group row">
        <label class="col-3">PIC</label>
        <div class="col-9">
          <input class="form-control" [(ngModel)]="parameter.pic">
        </div>
      </div>
      <div class="form-group row">
        <label class="col-3">Status</label>
        <div class="col-9">
          <select class="form-control" [(ngModel)]="parameter.status">
            <option value="">-- Pilih --</option>
            <option value="-1">Void</option>
            <option value="1">Aktif</option>
          </select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-3" style="line-height: 23px">Piutang</label>
        <div class="col-9">
          <div class="form-check">
            <label class="custom-control custom-radio">
              <input type="radio" [value]="-1" [(ngModel)]="parameter.arap" class="custom-control-input"
                name="arapType">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description">Tampilkan semua</span>
            </label>
          </div>
          <div class="form-check">
            <label class="custom-control custom-radio">
              <input type="radio" [value]="inv.INVOICE_ARAP" [(ngModel)]="parameter.arap" class="custom-control-input"
                name="arapType">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description">Tampilkan outstanding</span>
            </label>
          </div>
          <div class="form-check">
            <label class="custom-control custom-radio">
              <input type="radio" [value]="inv.INVOICE_NON_ARAP" [(ngModel)]="parameter.arap"
                class="custom-control-input"
                name="arapType">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description">Tampilkan non-outstanding</span>
            </label>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-3"></label>
        <div class="col-9">
          <button class="btn btn-success" (click)="submitSearch()">Cari</button>
        </div>
      </div>
    </div>
  </ng-template>
  <div class="invoice-container">
    <popup [show]="shownInvoice" (hidding)="shownInvoice =! shownInvoice">
      <div class="main-container">
        <invoice #invoice (onSave)="saveInvoice()">
          <invoice-receipt #invoiceReceipt [enabled]="false"></invoice-receipt>
          <invoice-payment [manualDiscGlobal]="true" #invoicePayment [forceEnableState]="true"></invoice-payment>
        </invoice>
      </div>
    </popup>
    <div class="contact">
      <popup [show]="shownContact" (hidding)="shownContact =! shownContact">
        <div class="main-container">
          <cashiering-search-contact #searchContact [alwaysOn]="true"
            (onChose)="saveNewContact($event)"></cashiering-search-contact>
        </div>
      </popup>
    </div>
  </div>
  <toaster-container [toasterconfig]="config"></toaster-container>
